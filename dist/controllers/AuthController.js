const a4_0x32e35=a4_0x16af;function a4_0x16af(_0xc032f5,_0xc8cf80){const _0x3f05a4=a4_0x3f05();return a4_0x16af=function(_0x16af53,_0x38f0bb){_0x16af53=_0x16af53-0x94;let _0x3c24ab=_0x3f05a4[_0x16af53];return _0x3c24ab;},a4_0x16af(_0xc032f5,_0xc8cf80);}function a4_0x3f05(){const _0x288543=['12813ptErir','function','getOwnPropertyDescriptor','/refresh','login','215373ePDTcu','findOneByOrFail','design:type','logout','69555tdVSou','findOneBy','The\x20given\x20refresh\x20token\x20is\x20not\x20valid','hex','design:paramtypes','1482584poVhiS','/login','UserDoesNotExist','/logout','__metadata','323645eywjLL','hash','defineProperty','46GyrBYY','design:returntype','153PhLDSq','The\x20given\x20password\x20is\x20incorrect\x20for\x20this\x20account','__decorate','prototype','object','length','jti','sub','refresh','passwordHash','2441250lxhZaK','decorate','No\x20account\x20associated\x20with\x20the\x20given\x20username\x20was\x20found','password','metadata','split','85160gCrngR','__param'];a4_0x3f05=function(){return _0x288543;};return a4_0x3f05();}(function(_0x248dd6,_0x1d87ad){const _0x3a3284=a4_0x16af,_0x1bc32b=_0x248dd6();while(!![]){try{const _0x31c6d7=-parseInt(_0x3a3284(0xa0))/0x1+-parseInt(_0x3a3284(0xb1))/0x2*(parseInt(_0x3a3284(0x9b))/0x3)+parseInt(_0x3a3284(0xa9))/0x4+-parseInt(_0x3a3284(0xa4))/0x5+parseInt(_0x3a3284(0xbd))/0x6+-parseInt(_0x3a3284(0xae))/0x7+parseInt(_0x3a3284(0x99))/0x8*(-parseInt(_0x3a3284(0xb3))/0x9);if(_0x31c6d7===_0x1d87ad)break;else _0x1bc32b['push'](_0x1bc32b['shift']());}catch(_0x436b43){_0x1bc32b['push'](_0x1bc32b['shift']());}}}(a4_0x3f05,0x36654));var __decorate=this&&this[a4_0x32e35(0xb5)]||function(_0x3373c5,_0x168a37,_0x3a571b,_0xf658f){const _0x2f510f=a4_0x32e35;var _0x172e25=arguments[_0x2f510f(0xb8)],_0x59d4af=_0x172e25<0x3?_0x168a37:_0xf658f===null?_0xf658f=Object[_0x2f510f(0x9d)](_0x168a37,_0x3a571b):_0xf658f,_0x552327;if(typeof Reflect==='object'&&typeof Reflect[_0x2f510f(0x94)]==='function')_0x59d4af=Reflect[_0x2f510f(0x94)](_0x3373c5,_0x168a37,_0x3a571b,_0xf658f);else{for(var _0x16bab8=_0x3373c5['length']-0x1;_0x16bab8>=0x0;_0x16bab8--)if(_0x552327=_0x3373c5[_0x16bab8])_0x59d4af=(_0x172e25<0x3?_0x552327(_0x59d4af):_0x172e25>0x3?_0x552327(_0x168a37,_0x3a571b,_0x59d4af):_0x552327(_0x168a37,_0x3a571b))||_0x59d4af;}return _0x172e25>0x3&&_0x59d4af&&Object[_0x2f510f(0xb0)](_0x168a37,_0x3a571b,_0x59d4af),_0x59d4af;},__metadata=this&&this[a4_0x32e35(0xad)]||function(_0x268c76,_0x412c07){const _0x57e1f9=a4_0x32e35;if(typeof Reflect===_0x57e1f9(0xb7)&&typeof Reflect[_0x57e1f9(0x97)]===_0x57e1f9(0x9c))return Reflect[_0x57e1f9(0x97)](_0x268c76,_0x412c07);},__param=this&&this[a4_0x32e35(0x9a)]||function(_0x142317,_0x4f1692){return function(_0x26b3d8,_0x1c4896){_0x4f1692(_0x26b3d8,_0x1c4896,_0x142317);};};import{timingSafeEqual}from'crypto';import{Body,JsonController,OnUndefined,Post,UnauthorizedError}from'routing-controllers';import{generateTokens,revokeRefreshToken}from'../auth/jwt.js';import{hashPassword}from'../auth/password.js';import a4_0x5607a2 from'../decorators/CurrentRefreshToken.js';import a4_0x41d334 from'../entities/RevokedRefreshToken.js';import a4_0x3317f4 from'../entities/User.js';import a4_0x1eea3a from'../dtos/LoginDto.js';import a4_0xd09067 from'../errors/CustomBadRequestError.js';let AuthController=class AuthController{async['login'](_0x483242){const _0x395a34=a4_0x32e35;let _0x33166e=await a4_0x3317f4[_0x395a34(0xa5)]({'username':_0x483242['username']});if(!_0x33166e)throw new a4_0xd09067(_0x395a34(0xab),_0x395a34(0x95));let [_0x3a3659,_0x10d6e2]=_0x33166e[_0x395a34(0xbc)][_0x395a34(0x98)](':'),_0x223c70=Buffer['from'](_0x10d6e2,_0x395a34(0xa7)),_0x3f0956=(await hashPassword(_0x483242[_0x395a34(0x96)],_0x3a3659,_0x395a34(0xa7)))[_0x395a34(0xaf)];if(!timingSafeEqual(_0x223c70,_0x3f0956))throw new a4_0xd09067('IncorrectPassword',_0x395a34(0xb4));return generateTokens(_0x33166e);}async[a4_0x32e35(0xa3)](_0x136cc4){const _0x228b8a=a4_0x32e35;try{await revokeRefreshToken(_0x136cc4);}catch(_0x510543){throw new UnauthorizedError(_0x228b8a(0xa6));}}async[a4_0x32e35(0xbb)](_0x6d61c7){const _0x230193=a4_0x32e35;try{let _0x160b4c=await a4_0x41d334['findOneBy']({'jti':_0x6d61c7[_0x230193(0xb9)]});if(_0x160b4c)throw new Error();await revokeRefreshToken(_0x6d61c7);let _0x1aa5a3=await a4_0x3317f4[_0x230193(0xa1)]({'id':_0x6d61c7[_0x230193(0xba)]});return generateTokens(_0x1aa5a3);}catch(_0x1b1a3c){throw new UnauthorizedError(_0x230193(0xa6));}}};__decorate([Post(a4_0x32e35(0xaa)),__param(0x0,Body()),__metadata(a4_0x32e35(0xa2),Function),__metadata(a4_0x32e35(0xa8),[a4_0x1eea3a]),__metadata(a4_0x32e35(0xb2),Promise)],AuthController[a4_0x32e35(0xb6)],a4_0x32e35(0x9f),null),__decorate([Post(a4_0x32e35(0xac)),OnUndefined(0xcc),__param(0x0,a4_0x5607a2()),__metadata(a4_0x32e35(0xa2),Function),__metadata(a4_0x32e35(0xa8),[Object]),__metadata('design:returntype',Promise)],AuthController[a4_0x32e35(0xb6)],a4_0x32e35(0xa3),null),__decorate([Post(a4_0x32e35(0x9e)),__param(0x0,a4_0x5607a2()),__metadata(a4_0x32e35(0xa2),Function),__metadata('design:paramtypes',[Object]),__metadata(a4_0x32e35(0xb2),Promise)],AuthController[a4_0x32e35(0xb6)],a4_0x32e35(0xbb),null),AuthController=__decorate([JsonController()],AuthController);export default AuthController;