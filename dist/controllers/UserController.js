const a6_0x44b01e=a6_0x5ae5;(function(_0x78da2e,_0x28da08){const _0x5bbb68=a6_0x5ae5,_0x578d23=_0x78da2e();while(!![]){try{const _0x37b9e5=parseInt(_0x5bbb68(0x1ad))/0x1+parseInt(_0x5bbb68(0x1c6))/0x2+-parseInt(_0x5bbb68(0x1a5))/0x3+parseInt(_0x5bbb68(0x1b2))/0x4*(-parseInt(_0x5bbb68(0x1cb))/0x5)+parseInt(_0x5bbb68(0x1ac))/0x6+parseInt(_0x5bbb68(0x1bb))/0x7+-parseInt(_0x5bbb68(0x1cf))/0x8;if(_0x37b9e5===_0x28da08)break;else _0x578d23['push'](_0x578d23['shift']());}catch(_0x22b5bd){_0x578d23['push'](_0x578d23['shift']());}}}(a6_0x1d70,0x5b52b));var __decorate=this&&this['__decorate']||function(_0x5d398f,_0x14bb81,_0xa96314,_0x57e71f){const _0x1ec1fa=a6_0x5ae5;var _0x430a79=arguments[_0x1ec1fa(0x1b0)],_0xea7118=_0x430a79<0x3?_0x14bb81:_0x57e71f===null?_0x57e71f=Object[_0x1ec1fa(0x1a8)](_0x14bb81,_0xa96314):_0x57e71f,_0xfd4684;if(typeof Reflect===_0x1ec1fa(0x1c1)&&typeof Reflect[_0x1ec1fa(0x1c7)]===_0x1ec1fa(0x1b7))_0xea7118=Reflect['decorate'](_0x5d398f,_0x14bb81,_0xa96314,_0x57e71f);else{for(var _0xb1d908=_0x5d398f[_0x1ec1fa(0x1b0)]-0x1;_0xb1d908>=0x0;_0xb1d908--)if(_0xfd4684=_0x5d398f[_0xb1d908])_0xea7118=(_0x430a79<0x3?_0xfd4684(_0xea7118):_0x430a79>0x3?_0xfd4684(_0x14bb81,_0xa96314,_0xea7118):_0xfd4684(_0x14bb81,_0xa96314))||_0xea7118;}return _0x430a79>0x3&&_0xea7118&&Object[_0x1ec1fa(0x1c3)](_0x14bb81,_0xa96314,_0xea7118),_0xea7118;},__metadata=this&&this[a6_0x44b01e(0x1d0)]||function(_0x45f333,_0x4d2538){const _0x5b373b=a6_0x44b01e;if(typeof Reflect===_0x5b373b(0x1c1)&&typeof Reflect[_0x5b373b(0x1ce)]===_0x5b373b(0x1b7))return Reflect['metadata'](_0x45f333,_0x4d2538);},__param=this&&this[a6_0x44b01e(0x1bf)]||function(_0x1dfbf2,_0x143071){return function(_0x595978,_0x7e96a1){_0x143071(_0x595978,_0x7e96a1,_0x1dfbf2);};};import{Body,Get,Post,Put,Delete,JsonController,OnUndefined,HttpCode,Authorized,CurrentUser}from'routing-controllers';function a6_0x1d70(){const _0x2242c5=['function','A\x20user\x20with\x20name\x20\x27','getOne','/users','4523393BsQlzQ','design:paramtypes','role','CannotDeleteUser','__param','hex','object','design:returntype','defineProperty','getAll','design:type','61544Dgyrlj','decorate','put','admin\x20user\x20can\x27t\x20be\x20deleted.','changePassword','5aiYIqD','/users/:id','password','metadata','1867048tzsCeo','__metadata','remove','post','1188600UnUDlt','save','find','getOwnPropertyDescriptor','prototype','current\x20user','split','1993200SHwqeD','388622VxbTks','admin','hash','length','passwordHash','1576612KwAusg','The\x20old\x20password\x20is\x20not\x20correct.','username','toHexString','UserNameNotUnique'];a6_0x1d70=function(){return _0x2242c5;};return a6_0x1d70();}import a6_0x1236cf from'../entities/User.js';import a6_0x3ca9f7 from'../dtos/UserDto.js';function a6_0x5ae5(_0x57adec,_0x357e57){const _0x1d70ef=a6_0x1d70();return a6_0x5ae5=function(_0x5ae59d,_0x35d83b){_0x5ae59d=_0x5ae59d-0x1a3;let _0x4075c3=_0x1d70ef[_0x5ae59d];return _0x4075c3;},a6_0x5ae5(_0x57adec,_0x357e57);}import{hashPassword}from'../auth/password.js';import a6_0x3ae906 from'../decorators/UserFromParam.js';import a6_0x426398 from'../decorators/PartialBody.js';import a6_0x2e9de4 from'../dtos/PasswordDto.js';import{timingSafeEqual}from'crypto';import a6_0x4648ce from'../errors/CustomBadRequestError.js';import{isUniqueViolationError}from'../utils.js';let UserController=class UserController{[a6_0x44b01e(0x1c4)](){const _0xe79069=a6_0x44b01e;return a6_0x1236cf[_0xe79069(0x1a7)]();}[a6_0x44b01e(0x1b9)](_0x4b3286){return _0x4b3286;}async[a6_0x44b01e(0x1a4)](_0x3dd76d){const _0x49c779=a6_0x44b01e;try{let _0x1bfc40=new a6_0x1236cf();return _0x1bfc40[_0x49c779(0x1bd)]=_0x3dd76d[_0x49c779(0x1bd)],_0x1bfc40[_0x49c779(0x1b4)]=_0x3dd76d['username'],_0x1bfc40[_0x49c779(0x1b1)]=(await hashPassword(_0x3dd76d[_0x49c779(0x1cd)]))[_0x49c779(0x1b5)](),await _0x1bfc40[_0x49c779(0x1a6)](),_0x1bfc40;}catch(_0x3f73b2){if(isUniqueViolationError(_0x3f73b2))throw new a6_0x4648ce(_0x49c779(0x1b6),_0x49c779(0x1b8)+_0x3dd76d[_0x49c779(0x1b4)]+'\x27\x20already\x20exists');throw _0x3f73b2;}}async['changePassword'](_0x264de2,_0x1d3879){const _0x519e74=a6_0x44b01e;let {oldPassword:_0x35f695,newPassword:_0x4dafe0}=_0x1d3879,[_0x523b40,_0x27c7ad]=_0x264de2[_0x519e74(0x1b1)][_0x519e74(0x1ab)](':'),_0x26854d=(await hashPassword(_0x35f695,_0x523b40,'hex'))[_0x519e74(0x1af)],_0x4268f2=Buffer['from'](_0x27c7ad,_0x519e74(0x1c0));if(!timingSafeEqual(_0x26854d,_0x4268f2))throw new a6_0x4648ce('IncorrectPassword',_0x519e74(0x1b3));_0x264de2[_0x519e74(0x1b1)]=(await hashPassword(_0x4dafe0))[_0x519e74(0x1b5)](),await _0x264de2[_0x519e74(0x1a6)]();}async[a6_0x44b01e(0x1c8)](_0x25b1e0,_0x1302b8){const _0x3e4834=a6_0x44b01e;try{let {username:_0x231bcf,password:_0x3410a6,role:_0x3a358e}=_0x1302b8;return _0x25b1e0['username']=_0x231bcf??_0x25b1e0[_0x3e4834(0x1b4)],_0x25b1e0[_0x3e4834(0x1bd)]=_0x3a358e??_0x25b1e0[_0x3e4834(0x1bd)],_0x25b1e0['passwordHash']=_0x3410a6?(await hashPassword(_0x3410a6))['toHexString']():_0x25b1e0['passwordHash'],await _0x25b1e0[_0x3e4834(0x1a6)](),_0x25b1e0;}catch(_0x3f20b1){if(isUniqueViolationError(_0x3f20b1))throw new a6_0x4648ce('UserNameNotUnique',_0x3e4834(0x1b8)+_0x1302b8[_0x3e4834(0x1b4)]+'\x27\x20already\x20exists');throw _0x3f20b1;}}async[a6_0x44b01e(0x1a3)](_0x3763b7){const _0x39948a=a6_0x44b01e;if(_0x3763b7['username']===_0x39948a(0x1ae))throw new a6_0x4648ce(_0x39948a(0x1be),_0x39948a(0x1c9));await _0x3763b7[_0x39948a(0x1a3)]();}};__decorate([Authorized(a6_0x44b01e(0x1ae)),Get(a6_0x44b01e(0x1ba)),__metadata(a6_0x44b01e(0x1c5),Function),__metadata(a6_0x44b01e(0x1bc),[]),__metadata('design:returntype',Promise)],UserController[a6_0x44b01e(0x1a9)],a6_0x44b01e(0x1c4),null),__decorate([Authorized([a6_0x44b01e(0x1ae),a6_0x44b01e(0x1aa)]),Get(a6_0x44b01e(0x1cc)),__param(0x0,a6_0x3ae906('id')),__metadata(a6_0x44b01e(0x1c5),Function),__metadata('design:paramtypes',[a6_0x1236cf]),__metadata(a6_0x44b01e(0x1c2),a6_0x1236cf)],UserController[a6_0x44b01e(0x1a9)],a6_0x44b01e(0x1b9),null),__decorate([Authorized(a6_0x44b01e(0x1ae)),Post(a6_0x44b01e(0x1ba)),HttpCode(0xc9),__param(0x0,Body()),__metadata(a6_0x44b01e(0x1c5),Function),__metadata(a6_0x44b01e(0x1bc),[a6_0x3ca9f7]),__metadata(a6_0x44b01e(0x1c2),Promise)],UserController['prototype'],a6_0x44b01e(0x1a4),null),__decorate([Authorized(),Put('/users/current/password'),OnUndefined(0xcc),__param(0x0,CurrentUser({'required':!![]})),__param(0x1,Body()),__metadata(a6_0x44b01e(0x1c5),Function),__metadata(a6_0x44b01e(0x1bc),[a6_0x1236cf,a6_0x2e9de4]),__metadata('design:returntype',Promise)],UserController[a6_0x44b01e(0x1a9)],a6_0x44b01e(0x1ca),null),__decorate([Authorized(a6_0x44b01e(0x1ae)),Put('/users/:id'),__param(0x0,a6_0x3ae906('id')),__param(0x1,a6_0x426398({'type':a6_0x3ca9f7})),__metadata('design:type',Function),__metadata(a6_0x44b01e(0x1bc),[a6_0x1236cf,Object]),__metadata('design:returntype',Promise)],UserController[a6_0x44b01e(0x1a9)],a6_0x44b01e(0x1c8),null),__decorate([Authorized(a6_0x44b01e(0x1ae)),Delete(a6_0x44b01e(0x1cc)),OnUndefined(0xcc),__param(0x0,a6_0x3ae906('id')),__metadata(a6_0x44b01e(0x1c5),Function),__metadata(a6_0x44b01e(0x1bc),[a6_0x1236cf]),__metadata(a6_0x44b01e(0x1c2),Promise)],UserController[a6_0x44b01e(0x1a9)],a6_0x44b01e(0x1a3),null),UserController=__decorate([JsonController()],UserController);export default UserController;